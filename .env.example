# Example environment configuration for IPAM + NetFlow
# Copy to ".env" for local dev or export variables in your environment.

########################################
# Core Application
########################################

# Database connection string
# - SQLite (single-file, dev):
#   sqlite:///./ipam.db
# - Postgres (recommended for NetFlow):
#   postgresql+psycopg2://user:password@host:5432/ipam
DATABASE_URL=postgresql+psycopg2://ipam:ipam@db:5432/ipam

# Secret key for session cookies (change in production)
SECRET_KEY=change-me

# Initial admin password (used only on first start when creating default user)
ADMIN_PASSWORD=admin

# Logging level for app and jobs (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# Optional alternate env file path loaded on startup (default: .env)
#ENV_FILE=.env

########################################
# Scheduler & Scanning Toggles
########################################

# Disable the background scheduler entirely (1 = disabled)
#DISABLE_SCHEDULER=0

# Disable subnet sweep scanning (1 = disabled)
#DISABLE_SCANNING=0

# Enable/disable periodic Nmap scans (1 = enabled)
ENABLE_NMAP_SCHEDULER=1

########################################
# ICMP Pinger
########################################

# Interval between ICMP status checks (seconds)
SCAN_ICMP_INTERVAL_SECONDS=60

# Number of worker threads for ICMP pings
PING_WORKERS=64

########################################
# Subnet Sweep (enumerate and ping within subnets)
########################################

# Interval between subnet sweep jobs (minutes)
SCAN_SWEEP_INTERVAL_MINUTES=5

# Maximum number of addresses per subnet to sweep (skip larger)
MAX_SUBNET_SIZE=4096

# Concurrency for sweep pings
SWEEP_PING_WORKERS=128

# Timeout per ping during sweep (milliseconds)
SWEEP_PING_TIMEOUT_MS=500

########################################
# Nmap Port Scans
########################################

# Interval between Nmap scans (minutes)
SCAN_NMAP_INTERVAL_MINUTES=10

# Nmap scan arguments
# - If not running as root, -sS is replaced with -sT automatically.
# - Default: TCP top 1000 ports, service detection, polite timing.
NMAP_ARGS=-Pn -T3 --top-ports 1000 -sS -sV
# Run Nmap only for hosts currently detected as UP by ICMP (1 = enabled).
# When 0, scan all known hosts (still uses -Pn by default) which can be useful
# in environments where ICMP is filtered.
NMAP_REQUIRE_UP=0

########################################
# Reverse DNS (rDNS) Cache
########################################

# Periodic rDNS refresh interval (minutes)
RDNS_REFRESH_MINUTES=10

# Lookback window for selecting IPs from netflow_flows (minutes)
RDNS_LOOKBACK_MINUTES=1440

# Max number of IPs to resolve per run
RDNS_MAX_PER_RUN=300

# TTL for cached entries before re-resolving (minutes)
RDNS_TTL_MINUTES=1440

# Socket DNS timeout per query (seconds)
RDNS_TIMEOUT_SECONDS=0.5

########################################
# DNS Log Ingestion (forward DNS -> domain mapping)
########################################

# Enable the DNS log ingestion job (1 = enabled)
DNSLOG_ENABLE=1

# URL for DNS query logs (e.g., AdGuard Home /control/querylog)
# Example: http://192.168.81.34:81/control/querylog
DNSLOG_URL=

# Basic auth for the DNS log endpoint in form user:password (optional)
DNSLOG_BASIC_AUTH=

# Job interval (minutes) and fetch limits
DNSLOG_INTERVAL_MINUTES=5
DNSLOG_LIMIT=1000

# Max number of upserts per run to rdns_cache
DNSLOG_MAX_PER_RUN=500

########################################
# NetFlow v9 Collector
########################################

# Bind address and port for UDP collector
NETFLOW_BIND_HOST=0.0.0.0
NETFLOW_BIND_PORT=2055

# Batch size for inserting flows
NETFLOW_INSERT_BATCH=250

# Time-based flush interval when traffic is low (milliseconds)
NETFLOW_FLUSH_INTERVAL_MS=1000

# Hex dump controls for debugging packets
# DUMP_HEX=1 enables short hex in console; DUMP_HEX_LEN controls length
DUMP_HEX=0
DUMP_HEX_LEN=128

# Optional log file path for the collector (writes full logs + full hex dumps)
#NETFLOW_LOG_FILE=/var/log/netflow_collector.log

########################################
# NetFlow UI â€“ Interface Label Mapping
########################################

# Map ifIndex to names/roles for display on NetFlow page.
# Format: "index:Name,index2:Name2" (WAN/LAN names infer roles; others are neutral)
NETFLOW_IFINDEX_LABELS=1:WAN,2:LAN
